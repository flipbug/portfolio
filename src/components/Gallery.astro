---
import type { CollectionEntry } from "astro:content";
import LocalImage from "./LocalImage.astro";
import Filter from "./Filter.astro";

interface Props {
  posts: CollectionEntry<"gallery">[];
  tag?: string | undefined;
}

const { tag, posts } = Astro.props;
const filteredPosts = posts.filter(
  (post) => !post.data.hidden && post.data.image,
);

// Filter by tag if provided
const displayPosts = tag
  ? filteredPosts.filter((post) => post.data.tags.includes(tag))
  : filteredPosts;
---

<div>
  <Filter tag={tag} />

  <div class="gallery-grid">
    {
      displayPosts.map((post) => (
        <div class="gallery-item relative group overflow-hidden aspect-[3/4] bg-gray-100">
          <a
            href={`/gallery/${post.data.tags[0]}/${post.slug}`}
            class="block h-full"
          >
            <LocalImage
              imageUrl={post.data.image!}
              alt={post.data.title}
              width={650}
              class="w-full h-full object-cover object-center transition-transform duration-300 ease-in-out group-hover:scale-105"
            />
            <div class="absolute bottom-0 left-0 right-0 bg-black bg-opacity-70 text-white p-3 transform translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-in-out">
              <p class="text-sm font-medium">{post.data.title}</p>
            </div>
          </a>
        </div>
      ))
    }
  </div>
</div>

<style>
  .gallery-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 1.25rem;
  }

  /* Responsive grid columns */
  @media (max-width: 639px) {
    .gallery-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (min-width: 640px) and (max-width: 767px) {
    .gallery-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 768px) {
    .gallery-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  .gallery-item {
    transition: transform 0.2s ease-in-out;
  }

  .gallery-item:hover {
    transform: translateY(-2px);
  }
</style>
